# Dockerfile 中身の詳細解説（HTML-Snap プロジェクト）

---

## 各行の役割とポイント

```dockerfile
# Node.js公式イメージ（22系）をベースにする
FROM node:22
```

- Node.js 22 バージョンの公式イメージを利用し、OS・Node・npm のバージョンを完全固定。
- どこでも同じ環境を再現できる。

```dockerfile
# 作業ディレクトリを作成・移動
WORKDIR /app
```

- コンテナ内で作業するディレクトリ（/app）を指定。
- 以降のコマンドはこのディレクトリで実行される。

```dockerfile
# 依存インストール用ファイルのみ先にコピー
COPY package*.json ./
```

- 依存インストールに必要なファイル（package.json, package-lock.json）だけを先にコピー。
- 依存追加がない限り Docker のキャッシュが効き、ビルドが高速化。

```dockerfile
# 依存パッケージをクリーンインストール
RUN npm ci
```

- lock ファイル準拠で依存パッケージをクリーンインストール。
- npm install よりも再現性・速度・安全性が高い。

```dockerfile
# プロジェクト全体をコンテナにコピー
COPY . .
```

- プロジェクトの全ファイル（ソース・設定・テスト等）をコンテナにコピー。
- 依存インストール後にコピーすることで、依存追加がない限りキャッシュが効く。

```dockerfile
# デフォルトコマンド（品質チェック一括実行）
CMD ["npm", "run", "verify"]
```

- コンテナ起動時に `npm run verify`（lint・型チェック・テスト・ビルド一括）を自動実行。
- コマンド指定時はこの CMD が上書きされる。

---

## 運用ガイドラインとの関連

- 「環境差防止・再現性・品質担保・高速化」を意識した設計
- コミット前や CI で `docker run --rm html-snap-ci` で品質チェック
- 依存追加・設定変更時は必ず再ビルド

## まとめ

- 各ステップの意味を理解することで、運用・カスタマイズ・トラブル対応が容易になる
- ガイドラインに沿った Dockerfile 運用で、安定した開発・検証が可能

---

この解説を参考に、Dockerfile の各行の意味・役割を把握し、運用に活かしてください。
