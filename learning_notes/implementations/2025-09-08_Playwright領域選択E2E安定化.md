# Playwright E2E ãƒ†ã‚¹ãƒˆã®é ˜åŸŸé¸æŠå®‰å®šåŒ–ã®å·¥å¤«

## ğŸ“… å­¦ç¿’æ—¥æ™‚

2025 å¹´ 9 æœˆ 8 æ—¥

## âœ… çµè«–

é ˜åŸŸé¸æŠ E2E ãƒ†ã‚¹ãƒˆã§ã€ŒpostMessage ã«ã‚ˆã‚‹ã‚¤ãƒ™ãƒ³ãƒˆç›´æ¥é€ä¿¡ã€ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ã§ã€UI æ“ä½œã®ä¸å®‰å®šã•ã‚„å‰¯ä½œç”¨ã‚’æ’é™¤ã—ã€å…¨ä»¶å®Ÿè¡Œæ™‚ã§ã‚‚å®‰å®šã—ã¦ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚

## ğŸ§  è©³ç´°

### èƒŒæ™¯

- ä»¥å‰ã¯ iframe å†…ã®è¦ç´ ã‚’ Playwright ã§ç›´æ¥ã‚¯ãƒªãƒƒã‚¯ã—ã¦é ˜åŸŸé¸æŠã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¦ã„ãŸãŒã€
  - iframe ã®æç”»ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚„åº§æ¨™è¨ˆç®—ã®ã‚ºãƒ¬
  - ãƒ†ã‚¹ãƒˆé–“ã®çŠ¶æ…‹å‰¯ä½œç”¨
    ãªã©ã«ã‚ˆã‚Šã€å…¨ä»¶ä¸€æ‹¬å®Ÿè¡Œæ™‚ã«å¤±æ•—ã™ã‚‹ã“ã¨ãŒã‚ã£ãŸã€‚

### å·¥å¤«ã—ãŸç‚¹

- é ˜åŸŸé¸æŠã‚¤ãƒ™ãƒ³ãƒˆï¼ˆtype: "region-select"ï¼‰ã‚’ `window.postMessage` ã§ç›´æ¥é€ä¿¡ã™ã‚‹æ–¹å¼ã«å¤‰æ›´ã€‚
- ã“ã‚Œã«ã‚ˆã‚Šã€UI ã®ç‰©ç†çš„ãªæ“ä½œã‚„æç”»ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«ä¾å­˜ã›ãšã€ã‚¢ãƒ—ãƒªå´ã®çŠ¶æ…‹ã‚’ç¢ºå®Ÿã«å¤‰æ›´ã§ãã‚‹ã€‚
- postMessage é€ä¿¡å¾Œã€`waitForTimeout(100)` ã§çŠ¶æ…‹åæ˜ ã‚’å¾…ã¤ã“ã¨ã§ã€éåŒæœŸå‡¦ç†ã®æºã‚‰ãã‚‚å¸åã€‚

### ã‚³ãƒ¼ãƒ‰ä¾‹

```typescript
// é ˜åŸŸé¸æŠã‚¤ãƒ™ãƒ³ãƒˆã‚’ç›´æ¥postMessageã§é€ä¿¡
await page.evaluate(() => {
  window.postMessage(
    {
      type: "region-select",
      outerHTML: '<div id="selectable">é¸æŠãƒ†ã‚¹ãƒˆ</div>',
      rect: { width: 100, height: 30 },
    },
    "*"
  );
});
await page.waitForTimeout(100); // çŠ¶æ…‹åæ˜ å¾…ã¡
```

### åŠ¹æœ

- ãƒ†ã‚¹ãƒˆã®ç‹¬ç«‹æ€§ãƒ»å†ç¾æ€§ãŒå‘ä¸Šã—ã€å…¨ä»¶å®Ÿè¡Œã§ã‚‚å®‰å®šã—ã¦ãƒ‘ã‚¹ã™ã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚
- UI ã®ç´°ã‹ã„æŒ™å‹•ã‚„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«ä¾å­˜ã—ãªã„ãŸã‚ã€å°†æ¥çš„ãª UI å¤‰æ›´ã«ã‚‚å¼·ã„ã€‚

---

> æœ¬ãƒ¡ãƒ¢ã¯ `docs/learning-notes-guide.md` ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«æº–æ‹ ã—ã¦ã„ã¾ã™ã€‚
