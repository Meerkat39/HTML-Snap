# 単体テストと結合テストの違い

## 📅 学習日時

2025 年 9 月 7 日

## ✅ 結論

- **単体テスト**は「部品（関数・コンポーネント）単位」の正しさを検証するテスト。
- **結合テスト**は「複数の部品が連携したとき」の動作やフロー全体の正しさを検証するテスト。
- 目的も粒度も異なり、両方を組み合わせることで品質保証が強化される。

## 🧠 詳細

### 単体テスト（Unit Test）

- テスト対象：1 つの関数・1 つの React コンポーネントなど「最小単位」
- 例：`add(a, b)`関数の戻り値が正しいか、`Button`コンポーネントが props 通りに表示されるか
- 外部依存（API, DB, 他コンポーネント）はモックやスタブで置き換える
- 目的：ロジックや UI 部品の「局所的な正しさ」を保証
- メリット：バグの早期発見・修正が容易、テストが高速

### 結合テスト（Integration Test）

- テスト対象：複数の関数・コンポーネント・ロジックが「連携」したときの動作
- 例：エディタで HTML 入力 → プレビューに反映 → 画像コピー → 通知表示まで一連の流れ
- 外部依存は必要に応じてモックするが、部品間のやりとりは実際に動かす
- 目的：「部品同士のつなぎ目」や「ユーザーフロー全体」の正しさを保証
- メリット：単体テストでは気づけない連携バグや UI の抜け漏れを検出できる

### 違いのまとめ

| 観点       | 単体テスト                | 結合テスト                       |
| ---------- | ------------------------- | -------------------------------- |
| 粒度       | 最小単位（部品ごと）      | 複数部品の連携・フロー           |
| 目的       | 局所的な正しさ            | 連携・全体フローの正しさ         |
| 依存の扱い | モック・スタブで分離      | 連携部分は実際に動かす           |
| 例         | 関数の戻り値、UI 部品表示 | 入力 → 表示 → 通知など一連の流れ |

### 実際の使い分け

- 単体テストで「部品の品質」を担保し、結合テストで「ユーザー体験や主要フローの品質」を担保する
- どちらか一方だけでは不十分。両方をバランスよく導入するのがベスト

---

## 🧩 今回の具体例（HTML Snap プロジェクトより）

### 単体テストの流れ（例: Button コンポーネント）

```tsx
// Button.test.tsx
// 1つの部品（Button）の表示とクリック動作のみをテスト
render(<Button label="送信" onClick={fn} />);
expect(screen.getByText("送信")).toBeInTheDocument(); // ラベル表示を検証
fireEvent.click(screen.getByText("送信")); // クリックイベントを発火
expect(fn).toHaveBeenCalled(); // onClickが呼ばれたか検証
```

### 結合テストの流れ（例: PreviewPane）

```tsx
// PreviewPane.integration.test.tsx
// エディタ入力→プレビュー反映→画像コピー→通知表示まで一連の流れをテスト
render(<PreviewPane html="<h1>テスト</h1>" />);
const iframe = screen.getByTitle("HTMLプレビュー");
expect(iframe).toHaveAttribute("srcDoc", expect.stringContaining("テスト")); // プレビューに反映されているか
fireEvent.click(
  screen.getByRole("button", { name: "レンダリング結果を画像コピー" })
); // 画像コピー操作
await waitFor(() => {
  expect(
    screen.getByText(/画像をクリップボードにコピーしました/)
  ).toBeInTheDocument(); // 通知UIの表示を検証
});
```

---

このように、

- 単体テストは「部品ごと」
- 結合テストは「ユーザー操作やフロー全体」

を意識して使い分けるのがポイントです。
